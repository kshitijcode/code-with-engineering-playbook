# Using DocFx and Companion Tools

If you want a quick way to have a website with all your documentation coming from Markdown files and comments coming from code, you can use [DocFx](https://dotnet.github.io/docfx/). The website generated by DocFx also includes fast search capabilities. There are some gaps in the DocFx solution, but we've provided companion tools that help you fill those gaps. Also see the blog post [Providing quality documentation in your project with DocFx and Companion Tools](https://mtirion.medium.com/providing-quality-documentation-in-your-project-with-docfx-and-companion-tools-76aed42b1ddd) for more explanation about the solution.

## Quick Start

To get you started quickly from scratch, a zip-file is provided which can be used with some common folder, files and settings mentioned in the steps below. [Download this file](attachments/DocFxQuickStartup.zip) first to get you started quickly.

## Documents and projects folder structure

The easiest is to work with a [mono repository](https://mtirion.medium.com/monorepo-for-beginners-45d5059ab40e) where documentation and code live together. If that's not the case in your situation but still want to combine multiple repositories into one documentation website, you'll have to clone all repositories first to be able to combine the information.

In the steps below we'll consider the generation of the documentation website from this content structure:

```shell
├── docs                  // all documents
│   ├── .attachments
│           └── [...]     // all images and other attachments used by documents
│   ├── [... *.md]        // markdown files, with or without subfolders
│
├── src                   // all projects
│   ├── Project1
│           └── [...]
│   ├── Project2]
│           └── [...]
│
├── x-cross
│   ├── toc.yml           // Cross reference definition (optional)
│
├── docfx.json            // DocFx configuration
├── index.md              // Website landing page
├── toc.yml               // Definition of the horizontal content links
```

We'll be using the `DocLinkChecker` tool to validate all links in documentation and for orphaned attachments. That's the reason we have all attachments in the `.attachments` folder.

In the generated website from the quick startup package you'll see that the hierarchies of documentation and references is combined in the left table of contents. This is achieved by the definition and use of **x-cross\toc.yml**. If you don't want the hierarchies combined, just remove the  folder and file from your environment and (re)generate the website.

## 1. Install DocFx

Go to the [DocFx](https://dotnet.github.io/docfx/) website to the Download section and download the latest version of DocFx. You can also use tools like [Chocolatey](https://chocolatey.org/) to install DocFx:

```bash
choco install docfx
```

## 2.  Configure DocFx

Configuration for DocFx is done in a `docfx.json` file. Store this file in the root.

> You can store the docfx.json somewhere else in the hierarchy, but then you need to provide the path of the file as an argument to the docfx command so it can be located.

Below is a good configuration to start with, where documentation is in the **/docs** folder and the sources are in the **/src** folder:

```json
{
    "metadata": [
    {
          "src": [
          {
              "files": [ "src/**.csproj" ],
              "exclude": [ "_site/**", "**/bin/**", "**/obj/**", "**/[Tt]ests/**" ]
          }
          ],
          "dest": "reference",
          "disableGitFeatures": false
       }
    ],
    "build": {
        "content": [
            {
                "files": [ "reference/**" ]
            },
            {
                "files": [ "**.md", "**/toc.yml" ],
                "exclude": [ "_site/**", "**/bin/**", "**/obj/**", "**/[Tt]ests/**" ]
            }
        ],
        "resource": [
            { 
                "files": ["docs/.attachments/**"],
                "exclude": [ "_site/**", "**/bin/**", "**/obj/**", "**/[Tt]ests/**" ]
            }
        ],
        "template": [ "templates/cse" ],
        "globalMetadata": {
            "_appTitle": "CSE Documentation",
            "_enableSearch": true
        },
        "markdownEngineName": "markdig",
        "dest": "_site",
        "xrefService": ["https://xref.docs.microsoft.com/query?uid={uid}"]
    }
}
```

## 3. Setup some basic documents

We suggest starting with a basic documentation structure in the **/docs** folder. In the provided Quick Start zip-file we have a basic setup:

```shell
├── docs
│   ├── .attachments
│           └── [...]                           // All images and other attachments used by documents
│   ├── architecture-decisions
│           └── .order
│           └── decision-log.md       // Sample index into all ADRs
│           └── README.md          // This recipe document. Replace the content with something meaningful to the project
│   ├── getting-started
│           └── .order
│           └── README.md          // This recipe document. Replace the content with something meaningful to the project
│   ├── guidelines
│           └── .order
│           └── docs-guidelines.md  // General documentation guidelines
│           └── README.md          // Landing page
│   ├── templates                          // all templates like ADR template and such
│           └── .order
│           └── README.md          // Landing page
│   ├── working-agreements
│           └── .order
│           └── README.md          // Landing page
│   ├── .markdownlint.json          // Markdownlinter settings
│   ├── .order                                // Providing a fixed order of files and directories
│   ├── index.md                          // Landing page
```

Use template documents like working agreements and such from the [Agile Development section in the CSE Playbook](https://github.com/microsoft/code-with-engineering-playbook/tree/main/docs/agile-development), [Design Reviews recipe's section in the CSE Playbook](https://github.com/microsoft/code-with-engineering-playbook/tree/main/docs/design/design-reviews/recipes) and more.

To have a proper landing page of your documentation website, you can use a markdown file called INDEX.MD in the root of your repository. Contents can be something like this:

```markdown
# CSE Documentation

This is the landing page of the CSE Documentation website. This is the page to introduce everything on the website.

You can add specific links that are important to provide direct access.

> Try not to duplicate the links on the top of the page, unless it really makes sense.

To get started with the setup of this website, read the getting started document with the title [Using DocFx and Companion Tools](docs/getting-started/readme.md).

```

In the provided Quick Start zip-file a `.markdownlint.json` is included with the contents below. The [MD013 setting](https://github.com/markdownlint/markdownlint/blob/master/docs/RULES.md#md013---line-length) is set to false to prevent checking for maximum line length.

```json
{
    "MD013": false
}
```

## 4. Compile the companion tools and run them

> **NOTE:** To explain each step, we'll be going through the various steps in the next few paragraphs. In the provided sample however, a batch-file called **GenerateDocWebsite.cmd** is included. This script will take all the necessary steps to compile the tools, execute the checks, generate the table of contents and execute docfx to generate the website.

In the Quick Start zip-file we've also included the two companion tools `TocDocFxCreation` and `DocLinkChecker`.

> **NOTE**: of course the package contains a static version of the companion tools. To use the latest, greatest, get the latest version from the [DocFx Companion Tools repository](https://github.com/Ellerbach/docfx-companion-tools).

You can compile the tools from Visual Studio, but you can also run `dotnet build` in both tool folders.

The `DocLinkChecker` companion tool is used to validate what's in the docs folder. It validates links between documents and attachments in the docs folder and checks if there aren't orphaned attachments.

The `TocDocFxCreation` tool is needed to generate a table of contents for your documentation, so users can navigate between folders and documents. If you have compiled the tool, use this command to generate a table of content file `toc.yml`.

## 5. Run DocFx to generate the website

Run the `docfx` command to generate the website, by default in the **_site** folder.

> If you want to check the website in your local environment, provide the **--serve** option to either the **docfx** command or the **GenerateDocWebsite** script. A small webserver is launched that hosts your website, which is accessible with http://localhost:8080.

## 6. Style the website

If you started with the Quick Start zip-file, the website is generated using a custom theme using [material design](https://ovasquez.github.io/docfx-material/) and the Microsoft logo. You can change this to your likings. For more information see [How-to: Create A Custom Template | DocFX website (dotnet.github.io)](https://dotnet.github.io/docfx/tutorial/howto_create_custom_template.html).

## References

* [DocFX - static documentation generator](https://dotnet.github.io/docfx/index.html)
* [Available DocFx tools](https://dotnet.github.io/docfx/templates-and-plugins/tools-dashboard.html)
